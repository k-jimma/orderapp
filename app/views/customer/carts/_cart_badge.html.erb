<% cart_session = session[:cart] %>
<% item_count =
  if cart_session.present? && cart_session["table_token"].to_s == token.to_s
    (cart_session["items"] || []).sum { |cart_item| cart_item["qty"].to_i }
  else
    0
  end
%>

<%= link_to table_cart_path(token: token, staff: staff),
      class: "btn btn-ghost",
      aria: { label: "カートを見る" },
      data: { turbo_frame: "_top" } do %>
  カート
  <% if item_count > 0 %>
    <span class="pill"><%= item_count %></span>
  <% end %>
<% end %>
